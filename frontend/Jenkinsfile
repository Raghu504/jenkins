pipeline {
  // use Docker on the Jenkins host as the build agent
  agent {
    docker {
      image 'node:20-alpine'
      args  '-u root'        // run as root so npm can write to cache
    }
  }

  environment {
    APP_DIR      = 'frontend'
    CACHE_DIR    = "${WORKSPACE}/.npm"
    DOCKER_IMAGE = 'yourdockerhubid/yourapp:${BRANCH_NAME}'
  }

  stages {
    stage('Checkout') {
      steps {
        // defaults to checking out the whole repo
        echo "Building branch ${env.BRANCH_NAME}"
      }
    }

    stage('Install') {
      steps {
        dir("${APP_DIR}") {
          // use a workspace‐local cache
          sh "npm install --cache ${CACHE_DIR}"
        }
      }
    }

    stage('Build') {
      steps {
        dir("${APP_DIR}") {
          sh 'npm run build'
        }
      }
    }

    stage('Dockerize') {
      steps {
        sh """
          docker build \
            -t ${DOCKER_IMAGE} \
            -f ${APP_DIR}/Dockerfile \
            .
        """
      }
    }

    // optionally push:
    // stage('Push') { … }
  }
}

